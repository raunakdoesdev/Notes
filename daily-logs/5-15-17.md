# Daily Log 5/15/17

## Priorities

Karl sent me an email about what my priorities should be. I didn't quite realize that this is what he wanted so it's good that he sent this email. For now, I will stop working on the PyTorch nets and just let them run without my supervision on bdd3.

> Here are the priorities as I see them:
> 
> 1) figure out how to get z2_color running at at least 15Hz on the TX2.
> 
> 2) prepare script/recipe so that we can quickly get up the other TX2's with ROS, ZED, caffe and pyTorch.
> 
> Once pyTorch is working well on the TX2 along with caffe on the same machine I can evaluate if we will use it in place of caffe. If it doesn't perform as well as caffe then we won't use pyTorch unless there is a model that can't be run any other way.
> 
> All other network and hardware tasks are secondary to the above. Please keep me updated.
> 
> Thanks, Karl

## Jetson TX2 Optimization

I got an email back from Dustin, but I don't know if any of his suggestions will actually help the conversion between numpy and PyTorch that we were having trouble with. I'm just not clear which part of the process is being optimized if we follow his instructions.

>Hi Sauhaarda,
> 
>While using ROS camera capture, it’s not uncommon to experience slower camera streaming.   The memory management isn’t the best.  What I would recommend is using ZED SDK or V4L2 directly from a high-performance C/C++ library to THFloatTensor (or rather, THCudaTensor) and python.  To get the THFloatTensor/THCudaTensor containing the video frame into python, you can embed the interpreter into C/C++ and use the THP api to get the associated PyObject or use the PyTorch ffi extensions to retrieve the object from C/C++.  This will avoid extra memory copies.  This approach mirrors how I used to to it with LUA torch (using luaT library).   However, I also found this V4L2 package for python here:
> 
>https://pypi.python.org/pypi/v4l2
> 
>So you could get the camera video from that and create the torch.cuda.FloatTensor without leaving Python.  Or if you require ZED SDK, use the PyTorch ffi extensions from above to wrap ZED SDK as python.
> 
>Hope that helps,  
>Dustin
 
I'm planning on writing the following in respopnse:

>Hi Dustin,
>
>Thank your for your response, this has been a major help. The biggest slowdown for us so far has been the conversion to the PyTorch Float Tensor after we have gotten the image from ROS and converted it to a numpy array through an opencv function. I think using your first approach is faster as it optimizes this conversion by running it in C whereas the second approach still requires a conversion in Python which could slow things down. I was under the impression that PyTorch calls a C backend to do these conversions and operations on tensors in the first place, so would doing the conversion in C and embedding the resultant tensor back into Python really speed things up?
>
>Thanks,  
>Sauhaarda Chowdhuri

I am going to investigate a little bit more on the timing issue in PyTorch before I send it to make sure I have the facts right.
